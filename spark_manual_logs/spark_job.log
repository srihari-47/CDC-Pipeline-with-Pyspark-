2025-06-07 14:34:04,668 [INFO] [spark_job] Spark session started successfully..
2025-06-07 14:34:04,669 [INFO] [spark_job] Running job: bookings
2025-06-07 14:34:04,670 [INFO] [BookingCDCProcessor] Starting to connect to the stream
2025-06-07 14:34:04,670 [INFO] [BookingCDCProcessor] Reading stream
2025-06-07 14:34:07,442 [INFO] [BookingCDCProcessor] Successfully connected to stream.
2025-06-07 14:34:25,467 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Initializing sources', 'isDataAvailable': False, 'isTriggerActive': False}
2025-06-07 14:34:30,595 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Initializing sources', 'isDataAvailable': False, 'isTriggerActive': True}
2025-06-07 14:34:35,617 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:34:40,651 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Writing offsets to log', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:34:45,660 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:34:50,667 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:34:55,674 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:00,684 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:05,696 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:10,702 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:10,702 [INFO] [BookingCDCProcessor] Input rate: 815.5640753731952/sec, Processing rate: N/A, Batch ID: 2
2025-06-07 14:35:15,710 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:15,710 [INFO] [BookingCDCProcessor] Input rate: 815.5640753731952/sec, Processing rate: N/A, Batch ID: 2
2025-06-07 14:35:20,716 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:20,717 [INFO] [BookingCDCProcessor] Input rate: 335.1996513226271/sec, Processing rate: N/A, Batch ID: 3
2025-06-07 14:35:25,728 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:25,728 [INFO] [BookingCDCProcessor] Input rate: 335.1996513226271/sec, Processing rate: N/A, Batch ID: 3
2025-06-07 14:35:30,798 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Writing offsets to log', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:30,799 [INFO] [BookingCDCProcessor] Input rate: 1037.4597903912006/sec, Processing rate: N/A, Batch ID: 4
2025-06-07 14:35:36,248 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:36,248 [INFO] [BookingCDCProcessor] Input rate: 1037.4597903912006/sec, Processing rate: N/A, Batch ID: 4
2025-06-07 14:35:42,226 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:42,230 [INFO] [BookingCDCProcessor] Input rate: 1037.4597903912006/sec, Processing rate: N/A, Batch ID: 4
2025-06-07 14:35:47,556 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:47,572 [INFO] [BookingCDCProcessor] Input rate: 1037.4597903912006/sec, Processing rate: N/A, Batch ID: 4
2025-06-07 14:35:52,843 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:52,866 [INFO] [BookingCDCProcessor] Input rate: 1037.4597903912006/sec, Processing rate: N/A, Batch ID: 4
2025-06-07 14:35:57,909 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:35:57,909 [INFO] [BookingCDCProcessor] Input rate: 1037.4597903912006/sec, Processing rate: N/A, Batch ID: 4
2025-06-07 14:36:02,918 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:36:02,918 [INFO] [BookingCDCProcessor] Input rate: 1037.4597903912006/sec, Processing rate: N/A, Batch ID: 4
2025-06-07 14:36:07,926 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:36:07,926 [INFO] [BookingCDCProcessor] Input rate: 847.0727781072608/sec, Processing rate: N/A, Batch ID: 5
2025-06-07 14:36:12,935 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:36:12,935 [INFO] [BookingCDCProcessor] Input rate: 847.0727781072608/sec, Processing rate: N/A, Batch ID: 5
2025-06-07 14:36:17,947 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:36:17,947 [INFO] [BookingCDCProcessor] Input rate: 287.5136596307586/sec, Processing rate: N/A, Batch ID: 6
2025-06-07 14:36:22,956 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:36:22,956 [INFO] [BookingCDCProcessor] Input rate: 287.5136596307586/sec, Processing rate: N/A, Batch ID: 6
2025-06-07 14:36:28,224 [INFO] [BookingCDCProcessor] Streaming query status: {'message': 'Processing new data', 'isDataAvailable': True, 'isTriggerActive': True}
2025-06-07 14:36:28,225 [INFO] [BookingCDCProcessor] Input rate: 287.5136596307586/sec, Processing rate: N/A, Batch ID: 6
2025-06-07 14:36:32,069 [INFO] [BookingCDCProcessor] Signal handler called with signal 2
2025-06-07 14:36:33,319 [INFO] [py4j.clientserver] Error while receiving.
Traceback (most recent call last):
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 516, in send_command
    raise Py4JNetworkError("Answer from Java side is empty")
py4j.protocol.Py4JNetworkError: Answer from Java side is empty
2025-06-07 14:36:33,320 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:33,321 [ERROR] [root] Exception while sending command.
Traceback (most recent call last):
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 516, in send_command
    raise Py4JNetworkError("Answer from Java side is empty")
py4j.protocol.Py4JNetworkError: Answer from Java side is empty

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1038, in send_command
    response = connection.send_command(command)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 539, in send_command
    raise Py4JNetworkError(
py4j.protocol.Py4JNetworkError: Error while sending or receiving
2025-06-07 14:36:33,322 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:33,322 [ERROR] [BookingCDCProcessor] Error occurred while monitoring query: An error occurred while calling o96.stop
2025-06-07 14:36:35,325 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:35,325 [ERROR] [BookingCDCProcessor] Unexpected error occurred while monitoring query: [Errno 111] Connection refused
2025-06-07 14:36:35,326 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:35,326 [INFO] [BookingCDCProcessor] Waiting for stream termination...
2025-06-07 14:36:35,327 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:35,327 [ERROR] [BookingCDCProcessor] Unexpected error occurred while running the CDC job: [Errno 111] Connection refused
2025-06-07 14:36:35,328 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:35,328 [ERROR] [spark_job] Error occurred while running job: bookings
2025-06-07 14:36:35,328 [ERROR] [spark_job] Full stack Trace:
Traceback (most recent call last):
  File "/home/harisudhan/PycharmProjects/cdc_pipeline_pyspark/spark_files.zip/spark_app/utils/CDCBaseClass.py", line 152, in monitor_query
    while query.isActive:
          ^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/pyspark.zip/pyspark/sql/streaming/query.py", line 169, in isActive
    return self._jsq.isActive()
           ^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1321, in __call__
    answer = self.gateway_client.send_command(command)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1036, in send_command
    connection = self._get_connection()
                 ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 284, in _get_connection
    connection = self._create_new_connection()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 291, in _create_new_connection
    connection.connect_to_java_server()
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 438, in connect_to_java_server
    self.socket.connect((self.java_address, self.java_port))
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/harisudhan/PycharmProjects/cdc_pipeline_pyspark/spark_files.zip/spark_app/utils/CDCBaseClass.py", line 179, in monitor_query
    query.stop()
  File "/opt/spark/python/lib/pyspark.zip/pyspark/sql/streaming/query.py", line 372, in stop
    self._jsq.stop()
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1321, in __call__
    answer = self.gateway_client.send_command(command)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1036, in send_command
    connection = self._get_connection()
                 ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 284, in _get_connection
    connection = self._create_new_connection()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 291, in _create_new_connection
    connection.connect_to_java_server()
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 438, in connect_to_java_server
    self.socket.connect((self.java_address, self.java_port))
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/harisudhan/PycharmProjects/cdc_pipeline_pyspark/spark_files.zip/spark_app/utils/CDCBaseClass.py", line 206, in run
    self.monitor_query(self.query)
  File "/home/harisudhan/PycharmProjects/cdc_pipeline_pyspark/spark_files.zip/spark_app/utils/CDCBaseClass.py", line 183, in monitor_query
    query.awaitTermination()
  File "/opt/spark/python/lib/pyspark.zip/pyspark/sql/streaming/query.py", line 221, in awaitTermination
    return self._jsq.awaitTermination()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1321, in __call__
    answer = self.gateway_client.send_command(command)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1036, in send_command
    connection = self._get_connection()
                 ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 284, in _get_connection
    connection = self._create_new_connection()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 291, in _create_new_connection
    connection.connect_to_java_server()
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 438, in connect_to_java_server
    self.socket.connect((self.java_address, self.java_port))
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/harisudhan/PycharmProjects/cdc_pipeline_pyspark/spark_app/main.py", line 41, in run_job
    JOB_REGISTRY[job](spark)
  File "/home/harisudhan/PycharmProjects/cdc_pipeline_pyspark/spark_files.zip/spark_app/jobs/bookings_cdc.py", line 58, in booking_cdc
    cdc_processor.run()
  File "/home/harisudhan/PycharmProjects/cdc_pipeline_pyspark/spark_files.zip/spark_app/utils/CDCBaseClass.py", line 215, in run
    if self.query and self.query.isActive:
                      ^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/pyspark.zip/pyspark/sql/streaming/query.py", line 169, in isActive
    return self._jsq.isActive()
           ^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1321, in __call__
    answer = self.gateway_client.send_command(command)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/java_gateway.py", line 1036, in send_command
    connection = self._get_connection()
                 ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 284, in _get_connection
    connection = self._create_new_connection()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 291, in _create_new_connection
    connection.connect_to_java_server()
  File "/opt/spark/python/lib/py4j-0.10.9.7-src.zip/py4j/clientserver.py", line 438, in connect_to_java_server
    self.socket.connect((self.java_address, self.java_port))
ConnectionRefusedError: [Errno 111] Connection refused
2025-06-07 14:36:35,331 [ERROR] [spark_job] Application failed: [Errno 111] Connection refused
2025-06-07 14:36:35,331 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:35,331 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:35,331 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:35,331 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:35,331 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:35,332 [INFO] [py4j.clientserver] Closing down clientserver connection
2025-06-07 14:36:35,338 [INFO] [py4j.clientserver] Closing down clientserver connection
